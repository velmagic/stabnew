
var same_city;
var tc_status;
$(document).ready(function(){
    var cit = new Array("Абаза","Абакан","Абдулино","Абинск","Автуры","Агидель","Агрыз","Азнакаево","Азов","Айхал","Акбулак","Аксай","Алагир","Алапаевск","Алатырь","Алдан","Алейск","Александров","Александровск","Александровское","Алексеевка","Алексин","Алушта","Альметьевск","Амурск","Анадырь","Анапа","Ангарск","Анжеро-Судженск","Анна","Апатиты","Апрелевка","Апшеронск","Арамиль","Аргун","Ардон","Арзамас","Арзгир","Аркадак","Армавир","Армянск","Арсеньев","Арск","Артем","Артемовский","Архангельск","Асбест","Асино","Астрахань","Аткарск","Афипский","Ахтубинск","Ахтырский","Ачинск","Ачхой-Мартан","Аша","Бавлы","Багаевская","Байкальск","Байконур","Баймак","Бакал","Баксан","Балабаново","Балаково","Балахна","Балашиха","Балашов","Балезино","Балей","Балтийск","Барабинск","Барнаул","Барыш","Батайск","Бахчисарай","Бачатский","Бачи-Юрт","Бежецк","Безенчук","Белая Глина","Белая Калитва","Белгород","Белебей","Белев","Белово","Белогорск","Белокуриха","Белоозерский","Белорецк","Белореченск","Белоярский","Белый Яр","Бердск","Березники","Березовка","Березовский (Кемеровская область)","Березовский (Свердловская область)","Беслан","Бийск","Бикин","Биробиджан","Бирск","Благовещенск (Амурская область)","Благовещенск (Республика Башкортостан)","Благодарный","Бобров","Богданович","Богородицк","Богородск","Боготол","Бодайбо","Бокситогорск","Бологое","Болотное","Большой Камень","Бор","Борзя","Борисовка","Борисоглебск","Боровичи","Боровский","Бородино","Братск","Бронницы","Брюховецкая","Брянск","Бугульма","Бугуруслан","Буденновск","Бузулук","Буинск","Буй","Буйнакск","Бутурлиновка","Валдай","Валуйки","Ванино","Варениковская","Васильево","Великие Луки","Великий Новгород","Великий Устюг","Вельск","Венев","Верещагино","Верхнеднепровский","Верхний Уфалей","Верхняя Пышма","Верхняя Салда","Видное","Вилючинск","Вихоревка","Вичуга","Владивосток","Владикавказ","Владимир","Внуково","Волгоград","Волгодонск","Волгореченск","Волжск","Волжский","Вологда","Волоколамск","Волхов","Вольск","Воргашор","Воркута","Воронеж","Воскресенск","Востряково","Воткинск","Врангель","Всеволожск","Вуктыл","Выборг","Выкса","Выселки","Вышний Волочек","Вяземский","Вязники","Вязьма","Вятские Поляны","Гаврилов-Ям","Гагарин","Гай","Галич","Гатчина","Гвардейск","Геленджик","Георгиевск","Гиагинская","Глазов","Голицыно","Горно-Алтайск","Горняк (Алтайский край)","Горняк (Челябинская область)","Городец","Городище","Гороховец","Горьковский","Горячеводский","Горячий ключ","Грамотеино","Грибановский","Грозный","Грязи","Грязовец","Губаха","Губкин","Губкинский","Гудермес","Гуково","Гулькевичи","Гурьевск","Гусев","Гусиноозерск","Гусь-Хрустальный","Давлеканово","Дагестанские Огни","Далматово","Дальнегорск","Дальнереченск","Данилов","Данков","Дегтярск","Дедовск","Дербент","Десногорск","Джалиль","Джанкой","Дзержинск","Дзержинский","Дивногорск","Дивное","Димитровград","Динская","Дмитров","Добрянка","Долгопрудный","Домодедово","Донецк","Донское","Донской","Дубна","Дубовка","Дугулубгей","Дудинка","Дюртюли","Дятьково","Евпатория","Егорлыкская","Егорьевск","Ейск","Екатеринбург","Елабуга","Елань","Елец","Елизаветинская","Елизово","Еманжелинск","Емва","Енисейск","Ершов","Ессентуки","Ессентукская","Ефремов","Железноводск","Железногорск (Красноярский край)","Железногорск (Курская область)","Железногорск-Илимский","Железнодорожный","Жердевка","Жигулевск","Жирновск","Жуковка","Жуковский","Завитинск","Заводоуковск","Заводской (Приморский край)","Заводской (Республика Северная Осетия - Алания)","Заволжье","Заинск","Заполярный","Зарайск","Заречный (Пензенская область)","Заречный (Свердловская область)","Заринск","Зверево","Зеленогорск","Зеленоград","Зеленодольск","Зеленокумск","Зеленчукская","Зерноград","Зея","Зима","Зимовники","Златоуст","Знаменск","Иваново","Ивантеевка","Ивдель","Игра","Ижевск","Избербаш","Излучинск","Изобильный","Иланский","Ильский","Инза","Иноземцево","Инта","Ипатово","Ирбит","Иркутск","Исилькуль","Искитим","Истра","Ишим","Ишимбай","Йошкар-Ола","Кавалерово","Казань","Кайеркан","Калач","Калач-на-Дону","Калачинск","Калининград","Калининец","Калинино","Калининск","Калтан","Калуга","Калязин","Каменка","Каменск-Уральский","Каменск-Шахтинский","Камень-на-Оби","Камешково","Камские Поляны","Камызяк","Камышин","Камышлов","Канаш","Кандалакша","Каневская","Канск","Кантышево","Карабаново","Карабаш","Карабулак","Карасук","Карачаевск","Карачев","Карпинск","Карталы","Касимов","Касли","Каспийск","Катав-Ивановск","Катайск","Качканар","Кашин","Кашира","Кедровка","Кемерово","Кемь","Керчь","Кизел","Кизилюрт","Кизляр","Кимовск","Кимры","Кингисепп","Кинель","Кинель-Черкассы","Кинешма","Киреевск","Киржач","Кириши","Киров (Калужская область)","Киров (Кировская область)","Кировград","Кирово-Чепецк","Кировск (Ленинградская область)","Кировск (Мурманская область)","Кирсанов","Киселевск","Кисловодск","Климово","Климовск","Клин","Клинцы","Ковдор","Ковров","Ковылкино","Когалым","Кодинск","Козельск","Козьмодемьянск","Коломна","Колпашево","Колпино","Кольцово","Кольчугино","Коммунар","Комсомольск-на-Амуре","Комсомольский","Конаково","Кондопога","Кондрово","Константиновск","Копейск","Кораблино","Кореновск","Коркино","Королев","Корсаков","Коряжма","Косая Гора","Костомукша","Кострома","Котельники","Котельниково","Котельнич","Котлас","Котово","Котовск","Кохма","Коченево","Кочубеевское","Красноармейск (Московская область)","Красноармейск (Саратовская область)","Красновишерск","Красногвардейское","Красногорск","Краснодар","Красное Село","Краснознаменск","Краснокаменск","Краснокамск","Краснообск","Красноперекопск","Краснослободск","Краснотурьинск","Красноуральск","Красноуфимск","Красноярск","Красный Кут","Красный Сулин","Кропоткин","Крыловская","Крымск","Крюково","Кстово","Кубинка","Кувандык","Кудымкар","Кузнецк","Куйбышев","Кукмор","Кулебаки","Кулешовка","Кулунда","Кумертау","Кунгур","Купино","Курагино","Курган","Курганинск","Куровское","Курск","Куртамыш","Курчалой","Курчатов","Куса","Кушва","Кущевская","Кызыл","Кыштым","Кяхта","Лабинск","Лабытнанги","Лагань","Ладожская","Лакинск","Лангепас","Лебедянь","Ленинградская","Лениногорск","Ленинск","Ленинск-Кузнецкий","Ленск","Лермонтов","Лесной","Лесозаводск","Лесосибирск","Ливны","Ликино-Дулево","Линево","Липецк","Лиски","Лобня","Лодейное Поле","Лопатинский","Лосино-Петровский","Луга","Луховицы","Лучегорск","Лысково","Лысьва","Лыткарино","Льгов","Люберцы","Людиново","Лянтор","Магадан","Магас","Магнитогорск","Майкоп","Майма","Майский","Малаховка","Малая Вишера","Малгобек","Малоярославец","Мантурово","Мариинск","Маркс","Матвеев Курган","Махачкала","Мегион","Медведево","Медведовская","Медвежьегорск","Медногорск","Межгорье","Междуреченск","Меленки","Мелеуз","Менделеевск","Мензелинск","Металлострой","Миасс","Миллерово","Минеральные Воды","Минусинск","Мирный (Архангельская область)","Мирный (Республика Саха (Якутия))","Михайловка","Михайловск","Мичуринск","Можайск","Можга","Моздок","Монино","Мончегорск","Морозовск","Моршанск","Москва","Московский","Мостовской","Муравленко","Мурманск","Мурмаши","Муром","Мценск","Мыски","Мытищи","Набережные Челны","Навашино","Навля","Надым","Назарово","Назрань","Нальчик","Наро-Фоминск","Нарткала","Нарьян-Мар","Нахабино","Находка","Невель","Невельск","Невинномысск","Невьянск","Незлобная","Нелидово","Нерехта","Нерчинск","Нерюнгри","Нестеровская","Нефтегорск","Нефтекамск","Нефтекумск","Нефтеюганск","Нижневартовск","Нижнекамск","Нижнеудинск","Нижний Ломов","Нижний Новгород","Нижний Тагил","Нижняя Салда","Нижняя Тура","Никель","Николаевск","Николаевск-на-Амуре","Никольск","Никольско-Архангельский","Никольское","Новая Ляля","Новая Усмань","Новоалександровск","Новоалтайск","Новоаннинский","Нововоронеж","Новодвинск","Новозыбков","Новокубанск","Новокузнецк","Новокуйбышевск","Новомичуринск","Новомосковск","Новопавловск","Новопокровская","Новороссийск","Новосибирск","Новосиликатный","Новосинеглазовский","Новотитаровская","Новотроицк","Новоузенск","Новоульяновск","Новоуральск","Новочебоксарск","Новочеркасск","Новошахтинск","Новый Городок","Новый Оскол","Новый Уренгой","Ногинск","Норильск","Ноябрьск","Нурлат","Нытва","Нягань","Няндома","Обнинск","Обоянь","Обь","Одинцово","Озерск","Озеры","Октябрьск","Октябрьский","Окуловка","Оленегорск","Омск","Омутнинск","Онега","Орджоникидзевская","Орел","Оренбург","Орехово-Зуево","Орловский","Орск","Оса","Осинники","Осташков","Остров","Острогожск","Отрадная","Отрадное","Отрадный","Оха","Очер","Павлово","Павловск (Алтайский край)","Павловск (Воронежская область)","Павловск (Ленинградская область)","Павловская","Павловский Посад","Палласовка","Партизанск","Пашковский","Пенза","Первомайск","Первоуральск","Пересвет","Переславль-Залесский","Пермь","Персиановский","Пестово","Петергоф","Петров Вал","Петровск","Петровск-Забайкальский","Петрозаводск","Петропавловск-Камчатский","Петушки","Печора","Пикалево","Плавск","Пласт","Поворино","Подольск","Подпорожье","Пойковский","Покачи","Покров","Полевской","Полтавская","Полысаево","Полярные Зори","Полярный","Поронайск","Похвистнево","Почеп","Приволжск","Приволжский","Придонской","Приморско-Ахтарск","Приозерск","Приютово","Прокопьевск","Пролетарск","Промышленная","Протвино","Прохладный","Псков","Пугачев","Пушкин","Пушкино","Пущино","Пыть-Ях","Пятигорск","Радужный (Владимирская область)","Радужный (Ханты-Мансийский автономный округ)","Раевский","Разумное","Райчихинск","Раменское","Рассказово","Ревда","Реж","Реутов","Рефтинский","Ржев","Родники","Роза","Рославль","Россошь","Ростов","Ростов-на-Дону","Рошаль","Ртищево","Рубцовск","Рузаевка","Рыбинск","Рыбное","Рыльск","Ряжск","Рязань","Саки","Салават","Салехард","Сальск","Самара","Санкт-Петербург","Саракташ","Саранск","Сарапул","Саратов","Саров","Сасово","Сатка","Сафоново","Саяногорск","Саянск","Светлоград","Светлый","Светогорск","Свирск","Свободный","Свободы","Севастополь","Северо-Задонск","Северобайкальск","Северодвинск","Североморск","Североуральск","Северск","Северская","Сегежа","Селенгинск","Сельцо","Семенов","Семикаракорск","Семилуки","Сергач","Сергиев Посад","Сердобск","Серов","Серпухов","Сертолово","Сестрорецк","Сибай","Сим","Симферополь","Скопин","Славгород","Славянка","Славянск-на-Кубани","Сланцы","Слободской","Слюдянка","Смоленск","Снежинск","Собинка","Советск (Калининградская область)","Советск (Кировская область)","Советская Гавань","Советский","Сокол","Соликамск","Солнечногорск","Солнечный","Соль-Илецк","Сорочинск","Сортавала","Сосновоборск","Сосновый Бор","Сосногорск","Софрино","Сочи","Спасск-Дальний","Среднеуральск","Ставрополь","Старая Купавна","Старая Русса","Стародуб","Староминская","Старощербиновская","Старый Оскол","Степное","Стерлитамак","Стрежевой","Строитель (Белгородская область)","Строитель (Тамбовская область)","Струнино","Ступино","Суворов","Суворовская","Судак","Сузун","Сургут","Суровикино","Сурхахи","Сухиничи","Суходол","Сухой Лог","Сходня","Сызрань","Сыктывкар","Сысерть","Тавда","Таганрог","Тайга","Тайшет","Талица","Талнах","Тальменка","Тамбов","Тара","Тарко-Сале","Татарск","Таштагол","Тбилисская","Тверь","Тейково","Темрюк","Терек","Тимашевск","Тихвин","Тихорецк","Тобольск","Товарково","Тогучин","Тольятти","Томилино","Томск","Топки","Торжок","Торопец","Тосно","Тоцкое Второе","Трехгорный","Троицк (Московская область)","Троицк (Челябинская область)","Троицкая","Трубчевск","Трудовое","Туапсе","Туймазы","Тула","Тулун","Туринск","Тутаев","Тучково","Тында","Тырныауз","Тюмень","Тяжинский","Ува","Уварово","Углич","Удачный","Удомля","Ужур","Узловая","Улан-Удэ","Ульяновск","Унеча","Урай","Урус-Мартан","Урюпинск","Усинск","Усмань","Усолье-Сибирское","Уссурийск","Усть-Абакан","Усть-Джегута","Усть-Илимск","Усть-Катав","Усть-Кут","Усть-Лабинск","Усть-Ордынский","Уфа","Ухта","Учалы","Учкекен","Федоровский","Феодосия","Фокино (Брянская область)","Фокино (Приморский край)","Фролово","Фрязино","Фурманов","Хабаровск","Хадыженск","Ханты-Мансийск","Харабали","Хасавюрт","Химки","Холмск","Холмская","Хотьково","Цимлянск","Цоцин-Юрт","Чайковский","Чалтырь","Чапаевск","Чебаркуль","Чебоксары","Чегдомын","Чегем","Челябинск","Черемхово","Черепаново","Череповец","Черкесск","Черниговка","Черноголовка","Черногорск","Чернушка","Чернянка","Черняховск","Чехов","Чистополь","Чита","Чишмы","Чудово","Чунский","Чусовой","Шадринск","Шали","Шарыпово","Шарья","Шатура","Шахты","Шахунья","Шебекино","Шексна","Шелехов","Шерловая Гора","Шилка","Шилово","Шимановск","Шумерля","Шумиха","Шушары","Шушенское","Шуя","Щекино","Щелково","Щербинка","Щигры","Экажево","Электрогорск","Электросталь","Электроугли","Элиста","Энгельс","Энем","Юбилейный","Югорск","Южа","Южно-Сахалинск","Южноуральск","Южный","Юрга","Юрьев-Польский","Юрюзань","Яблоновский","Якутск","Ялта","Ялуторовск","Янаул","Яранск","Яровое","Ярославль","Ярцево","Ясногорск","Ясный","Яшкино");

    var loc = cit;

    $('#delivery_city').blur(function() {
        if ($.trim($(this).val()) == '') {
            showError('Не указан город доставки');
        } else if (loc.indexOf($.trim($(this).val())) == -1) {
            showError('Не корректно указан город доставки');
        }
    });

    function showError(msg) {
        $('#transComp').show().find('input').hide();
        $('.trans_comp').html('');
        $('#transCompResult').show();
        $('#transCompResult').text(msg);
        same_city = null;
    }

    $("#delivery_city").autocomplete({
        source: function( request, response ) {
            var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( request.term ), "i" );
            response( $.grep( loc, function( item ){
                return matcher.test( item );
            }) );
        },
        select: function( event, ui ) {
            if (ui.item.value !== same_city) {
                getDeliveryCost(ui.item.value, function(result){
                    if (result == 2) {
                        tc_status = 'TC_UNDEFINED';
                    } else {
                        tc_status = 'TC_EXISTS';
                    }
                });
            }

            same_city = ui.item.value;
        },
        change: function( event, ui ) {
            if ($(this).val() !== same_city || $(this).val() !== same_city && $('#transCompResult').is(':visible') && tc_status == 'TC_EXISTS') {
                if (loc.indexOf($.trim($(this).val())) !== -1) {
                    getDeliveryCost($.trim($(this).val()));
                } else if ($.trim($(this).val()) == '') {
                    showError('Не указан город доставки');
                        updateCart();
                } else {
                    showError('Не корректно указан город доставки');
                        updateCart();
                }
            }
        },
        autoFocus: true,
        delay: 3,
        minLength: 1
    });

    $("#delivery_city").focus(function() {
        $("#delivery_city").autocomplete("search");
    });

});